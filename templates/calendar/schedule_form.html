{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
    <h2>{{ is_edit|yesno:"ì¼ì • ìˆ˜ì •,ì¼ì • ì¶”ê°€" }}</h2>
    <form method="post" class="d-flex flex-column align-items-start">
        {% csrf_token %}
        {% if form.errors %}
        <div class="alert alert-danger">
            <ul class="mb-0">
                {% for field in form %}
                    {% if field.errors %}
                        <li><strong>{{ field.label }}</strong>
                            <ul>
                                {% for error in field.errors %}
                                    <li>{{ error }}</li>
                                {% endfor %}
                            </ul>
                        </li>
                    {% endif %}
                {% endfor %}
            </ul>
        </div>
        {% endif %}
        <!-- ê¸°ë³¸ í•„ë“œ ë Œë”ë§ -->
        {{ form.task_name.label_tag }} {{ form.task_name }}
        {{ form.duration_minutes.label_tag }} {{ form.duration_minutes }}
        {{ form.difficulty.label_tag }} {{ form.difficulty }}
        {{ form.importance.label_tag }} {{ form.importance }}
        {{ form.task_type.label_tag }} {{ form.task_type }}
        <!-- {{ form.subject.label_tag }} {{ form.subject }} -->
        {{ form.is_exam_task.label_tag }} {{ form.is_exam_task }}
        {{ form.exam.label_tag }} {{ form.exam }}
        {{ form.deadline.label_tag }} {{ form.deadline }}
        {{ form.start_time.label_tag }} {{ form.start_time }}
        <!-- {{ form.end_time.label_tag }} {{ form.end_time }} -->
        {{ form.is_fixed.label_tag }} {{ form.is_fixed }}

        <!-- ğŸ¨ ìƒ‰ìƒ ì„ íƒ í•„ë“œ ì§ì ‘ ë Œë”ë§ -->
        <div class="mb-3">
            <label for="id_color">ìƒ‰ìƒ</label>
            <select name="color" id="id_color" class="form-select">
                {% for code, label in form.fields.color.choices %}
                    <option value="{{ code }}"
                        {% if form.initial.color == code or form.data.color == code %}selected{% endif %}
                        style="background-color: {{ code }}; color: {% if code in '#FFBF00,#EEFF00,#00FF33' %}#000{% else %}#fff{% endif %};">
                        {{ label }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- ë²„íŠ¼ -->
        <button type="submit" class="btn btn-primary my-1">ì €ì¥</button>
        <a href="{% url 'calendar:index' %}" class="btn btn-secondary my-1">ì·¨ì†Œ</a>
        {% if is_edit %}
        <a href="{% url 'calendar:schedule_delete' id %}" class="btn btn-danger">ì‚­ì œ</a>
        {% endif %}
    </form>
</div>
<script>
    const colorSelect = document.getElementById("id_color");

    function updateSelectStyle() {
        const selectedColor = colorSelect.value;
        colorSelect.style.backgroundColor = selectedColor;

        // ê°€ë…ì„±ì„ ìœ„í•œ í…ìŠ¤íŠ¸ ìƒ‰
        const darkTextColors = ['#D9D96D', '#D9C56D', '#D9B86D', '#D9A46D', '#D98C6D'];
        colorSelect.style.color = darkTextColors.includes(selectedColor.toUpperCase()) ? '#000' : '#fff';
    }

    // ì´ˆê¸° ì‹¤í–‰
    updateSelectStyle();

    // ë³€ê²½ ì‹œ ì—…ë°ì´íŠ¸
    colorSelect.addEventListener("change", updateSelectStyle);
</script>

{% endblock %}
